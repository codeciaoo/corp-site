---
title: "RAG・生成AI活用による製造現場の安全管理システム開発"
description: "RAGと生成AIを組み合わせた高度な検索システムにより、製造現場の安全情報を効率的に提供し、作業者の安全確保を支援するシステムを開発"
summary: "製造業のお客様向けに、RAGと生成AIを活用した安全管理システムを開発。ハイブリッド検索とクロスエンコーダーによる高精度な情報抽出と、LLMによる状況に応じた安全アドバイスの提供により、現場の安全性を大幅に向上。"
publishedDate: 2024-12-20
tags: ["生成AI", "RAG", "安全管理", "製造業", "ハイブリッド検索", "ナレッジマネジメント", "POC", "業務効率化"]
---

# 製造業向け作業安全管理システムのPOCプロジェクト

## お客様の情報
- **業界：** 製造業
- **企業規模：** 従業員数 200-500名
- **事業内容：** 自動車部品の製造および組立

## プロジェクト概要
- **期間：** 5ヶ月
- **弊社側の体制：** PM 1名、エンジニア 2名
- **開発スタイル：** アジャイル開発（スクラム）
- **予算：** 800万円
- **範囲：** 製造現場向け安全支援システムのPOC開発（生成AIとRAGの統合ソリューション）

## ご相談の背景
- **情報の断絶と属人的な安全管理**
  - 安全情報が部署ごとに分散していた
  - 作業者がリスクを正確に把握できず、各自でマニュアルに頼る状況
  - 最新の安全情報が現場に伝わらず、不安が募っていた

- **リスク評価の不十分さ**
  - 単一のデータソースに依存していた
  - 現場の具体的な作業状況が十分に反映されなかった
  - 緊急時の迅速なリスク把握が困難な状況に直面

## 取り組みの結果
- **安全情報抽出の精度向上**
  - ハイブリッド検索（ベクトル＋キーワード）で精度70%を達成
  - クロスエンコーダーで関連性の高いドキュメントを上位に配置

- **生成AIによる現場最適化**
  - 多段階生成プロセスで、具体的な安全対策を提案
  - ユーザーからのフィードバックをもとに80%の満足度を実現

- **現場での実用性向上**
  - 70〜80%の作業者がシステムを「実用的」と評価
  - 短時間で必要な安全情報が得られることで、現場の安心感が向上

## プロジェクトの進行

### 1. 事前準備：ドキュメント整備フェーズ
RAG（Retrieval Augmented Generation）の精度を最大限に引き出すため、事前に社内ドキュメントの整備を実施：

- 生成AIを活用し、既存の安全マニュアルや作業手順書を検索しやすい形式に再構成
- 各ドキュメントに対して、メタデータ（作業種別、リスクレベル、対象工程など）を付与
- 類似内容の統合や、最新情報の反映による重複排除と鮮度維持

### 2. 要求分析と現状評価フェーズ
- 現場作業者および管理者へのヒアリングを実施し、情報断絶および安全リスクの現状を定量的に評価
- 過去のヒヤリハット事例や安全ドキュメントを選定し、各データに対してタグ付けを実施

### 3. 検索システムの設計と実装
高精度な情報検索を実現するため、3段階の検索パイプラインを構築：

| 段階 | 手法 | 入出力件数 | 主な効果 | 特徴・制約 |
|------|------|------------|----------|------------|
| 1. 初期検索 | ハイブリッド検索<br>（ベクトル検索70% + BM25 30%） | 全件 → 30件 | - 意味的類似性の検出<br>- キーワード完全一致の保証<br>- 専門用語・型番への対応 | - 高速な処理が可能<br>- 個別文書の詳細な意味理解は限定的 |
| 2. 精密リランキング | クロスエンコーダー | 30件 → 10件 | - より正確な類似度判定<br>- 文脈を考慮した順位付け<br>- 同義語や言い換えの理解 | - 計算コストが高い<br>- バッチ処理が必要<br>- 1対1の比較に限定 |
| 3. 最終調整 | LLMによるリランキング | 10件 → 6件<br>（順序変更） | - 複数文書の相対評価<br>- 業務要件の動的反映<br>- 暗黙知の活用 | - 処理時間が長い<br>- コストが高い<br>- プロンプト設計が重要 |

#### a) ハイブリッド検索の実装
当初、単純なベクトル検索のみを検討していましたが、以下の課題に直面：
- ベクトル検索は意味的な類似性を捉えるものの、キーワードの完全一致に弱い
- 作業者が使用する専門用語や型番の正確な検索に支障

そこで、以下の2つの検索手法を組み合わせたハイブリッド方式を採用しました：

1. **ベクトル検索（意味的類似性）**
   - 文章をベクトル（数百次元の数値配列）に変換し、コサイン類似度で類似度を計算
   - 例えば「作業員の安全確保」と「従業員の危険防止」のような、表現は異なるが意味的に近い文書を発見可能
   - 文脈を考慮した検索が可能だが、重要なキーワードの完全一致を保証できない

2. **BM25（キーワード重要度）**
   - 文書内の単語の出現頻度と重要度を考慮したスコアリング
   - 例えば「プレス機A-123の緊急停止手順」のような、具体的な型番や専門用語を含む検索に強い
   - キーワードの完全一致に基づく検索が可能だが、同義語や言い換えを考慮できない

これら2つの手法の特徴を活かし、以下のようなハイブリッド方式を実装：

```python
def hybrid_search(query):
    # ベクトル検索とBM25の重み付けスコアを算出
    vector_scores = vector_search(query)  # コサイン類似度
    bm25_scores = bm25_search(query)      # BM25スコア
    
    # スコアの正規化と重み付け（7:3）
    final_scores = 0.7 * normalize(vector_scores) + 0.3 * normalize(bm25_scores)
    return get_top_k(final_scores, k=30)  # 上位30件を抽出

# 注: このコードは実装イメージを示すサンプルです。実際のプロジェクトでは、
# より詳細なエラーハンドリングやパラメータ最適化、ベクトルストアの具体的な実装等が含まれます。
```

この重み付け（ベクトル検索:BM25 = 7:3）は、現場での試行錯誤を経て最適化した値です。これにより、意味的な類似性を重視しながらも、重要なキーワードの一致も確実に考慮した検索を実現しています。

#### b) クロスエンコーダーによるリランキング
ハイブリッド検索で抽出した上位30件に対し、より精緻な類似度判定を実施：

```python
def rerank_with_cross_encoder(query, candidates):
    model = CrossEncoder('model/cross-encoder-v1')
    pairs = [[query, doc] for doc in candidates]
    scores = model.predict(pairs)
    return get_top_k(scores, k=10)  # 最終的に上位10件を抽出

# 注: このコードは実装イメージを示すサンプルです。実際のプロジェクトでは、
# バッチ処理、キャッシング、モデルの具体的な設定、スコアの正規化処理等が実装されています。
```

ハイブリッド検索だけでは以下のような課題に直面したため、クロスエンコーダーを導入しました：

1. **ベクトル検索の技術的限界**
   - ベクトル検索（Bi-Encoder）は、クエリとドキュメントを別々にエンコードし、その後コサイン類似度で比較
   - この方式では、「ベルトコンベアの緊急停止手順」というクエリに対して「製造ライン停止時の作業手順」のような、表現は異なるが文脈的に重要な文書をうまく拾えないケースが発生

2. **クロスエンコーダーの優位性**
   - クロスエンコーダーは、クエリとドキュメントを同時にエンコードして類似度を算出
   - 例えば「溶接作業における火災対策」というクエリに対して：
     - 「金属加工時の防火措置」（意味的に関連）
     - 「溶接作業の基本手順」（キーワード一致）
     という2つの文書があった場合、文脈を考慮して前者を適切に高順位に評価可能

3. **現場特有の課題解決**
   - 製造現場では、同じ概念が部署によって異なる用語で表現されることが多く、以下のような事例で効果を発揮：
     - 「研磨工程の粉塵対策」というクエリに対して
     - 「バフ掛け作業における防塵手順」という文書を適切に高評価
   - 略語や専門用語の文脈理解も向上（例：「TIG」と「タングステン不活性ガス溶接」の関連付け）

ただし、クロスエンコーダーは計算コストが高いため、全文書に対して適用するのは現実的ではありません。そのため、ハイブリッド検索で絞り込んだ上位30件に対してのみ適用する2段階アプローチを採用しました。これにより、精度と処理速度のバランスを最適化しています。

#### c) LLMによる最終ランキング調整
抽出された10件のドキュメントを、作業現場の状況に応じて最適な順序に並び替え：

```python
def llm_sort(query, documents):
    # 以下は実装のイメージです。実際のプロンプトでは、
    # - 作業安全性の評価基準（人命に関わるリスク、設備リスク等）
    # - 現場特有の考慮要素（季節性、時間帯、法規制等）
    # - 過去の事故事例との関連性
    # などを構造化して指示します
    prompt = f"""
    作業内容: {query}
    以下の安全マニュアルを重要度順に並び替え、上位6件を選択してください。
    各マニュアルの選定理由と注意すべきポイントを付記してください。
    {documents}
    """
    return llm.generate(prompt)

# 注: このコードとプロンプトは実装イメージを示すサンプルです。
# 実際のプロジェクトでは、より詳細な評価基準や
# 業界特有の安全管理要件を考慮した本格的なプロンプトを使用しています。
```

この最終段階でLLMによるリランキングを採用した理由は、以下の技術的な利点に基づいています：

1. **コンテキストウィンドウの活用**
   - クロスエンコーダーが検索クエリと個々のドキュメントを1対1で評価するのに対し、LLMは検索クエリと10件のドキュメント全体を同時に処理
   - より広い文脈での関連性評価が可能となり、ドキュメント間の相対的な重要度も考慮した順序付けを実現

2. **柔軟なランキング基準の設定**
   - プロンプトエンジニアリングにより、現場特有の要件（例：作業の危険度、実施頻度、季節性など）を動的に反映
   - 評価基準の微調整が容易で、現場からのフィードバックを即座にランキングロジックに反映可能

3. **暗黙知の活用**
   - LLMの持つ一般的な知識を活用し、明示的なルールだけでは捉えきれない安全管理のニュアンスを考慮
   - 例えば、「重機を使用する作業」と「化学物質を扱う作業」が同時に該当する場合の優先順位付けなど

### 4. 生成AIによるカスタマイズアドバイス
- 検索結果を基に、具体的な安全対策や注意事項を多段階生成
- フィードバックループを組み込み、現場に最適化したアドバイスを提供

### 5. 評価と改善
システムの有効性を検証するため、3段階評価を実施：

- **評価基準：**
  - 2: そのまま使える
  - 1: 一部使える
  - 0: 全く使えない

- **評価概要：**
  - 評価期間：2週間
  - 評価者数：20名の現場作業者
  - 総評価件数：100件

- **結果：**
  - 「そのまま使える（2）」: 57%
  - 「一部使える（1）」: 42%
  - 「全く使えない（0）」: 11%

1または2の評価が合計で約90%となり、高い実用性を確認。また、以下の改善も実現：
- 短時間で必要な安全情報が得られることによる現場の安心感向上
- 継続的なフィードバックループによる検索精度と生成内容の最適化

このプロジェクトを通じ、弊社はお客様に対して、現場作業の安全性向上を実現する革新的なソリューションを提供。製造現場での事故防止および効率的な安全管理の実現に大きく寄与いたしました。
